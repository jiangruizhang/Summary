# 20211117NOIP 总结

### 图 graph

比赛的时候已经想到了考虑每个点被直接删除的概率，但是就是没有想到怎么计算这个概率，其实很简单，就是$\frac{d_i}{d_i+1}$，$d_i$就是$i$的度数。

其实就是用$1$减去每一步都不是$i$的概率就好了，即$1-\frac{d_i}{d_i+1}\frac{d_i-1}{d_i}\dots$，就是$1-\frac{1}{d_i+1}=\frac{d_i}{d_i+1}$。

### 数 ds

ds是不是data structure的意思呢？

发现部分分还是可以的，前面是暴力，后面是带修莫队，还有$k=1$。

然后正解是分块，令块长$B=n^{\frac{2}{3}}$，那么块的个数$C=n^{\frac{1}{3}}$。

考虑记录$cnt_{i,j},ans_{i,j}$分别表示到快$i$末尾的各颜色的权的和，$ans_{i,j}$表示块$i$开头到块$j$的末尾的答案，这部分预处理的复杂度为$ O(n^{\frac{5}{3}})$。

考虑修改一个位置，那么要修改的$ans_{i,j}$的数量是$ n^{\frac{2}{3}}$个，要修改的$cnt_{i,j}$是$n^{\frac{1}{3}}$个，这部分是$O(n^{\frac{5}{3}})$。

考虑查询一段区间，那么先提取区间内极大的$ans_{i,j}$，然后向外拓展，最多拓展$n^{\frac{2}{3}}$个位置，这部分也是$O(n^{\frac{5}{3}})$。

综上，时间复杂度为$O(n^{\frac{5}{3}})$。

可以说是学了一个新的算法吧。

### 树 tree

构造题。

首先肯定是要分治的，每次$solve(x,dep)$一个子树，复原除了从$x$一直向右走的链，这样当分治完左右两边后，发现还有左儿子的右链没有复原，复原即可。

最后到根特殊处理，要流出两条链的一个位置用作交换，最后可能还要交换根和其中一个儿子。

### 拍 per

分析出了一些简单的性质，但是建模还没搞懂，留个坑。